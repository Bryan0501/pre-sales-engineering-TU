<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Sales Engineering</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1A56A8;
            --primary-dark: #0F3D7A;
            --primary-light: #3B8DD4;
            --accent: #5DADE2;
            --secondary: #D9534F;
            --bg: #F7F5F0;
            --bg-section: #FAFAF7;
            --surface: #FFFFFF;
            --text: #2C3E50;
            --text-muted: #7B8A99;
            --border: #D8DDE3;
            --border-light: #E8ECF0;
            --success: #2E86C1;
            --shadow: rgba(26, 86, 168, 0.06);
            --shadow-lg: rgba(15, 61, 122, 0.12);
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 2.5rem 1rem;
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 8px 30px var(--shadow-lg);
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--primary-light) 100%);
            color: white;
            padding: 2.5rem 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -8%;
            width: 450px;
            height: 450px;
            background: radial-gradient(circle, rgba(93,173,226,0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            border-radius: 50%;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            position: relative;
            z-index: 1;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.05rem;
            opacity: 0.85;
            position: relative;
            z-index: 1;
            font-weight: 400;
        }

        .main-content {
            padding: 2.5rem 2rem;
        }

        .section {
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-section);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.25s ease;
        }

        .section:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 16px var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-badge {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-size: 0.95rem;
        }

        label .required {
            color: #C0392B;
            margin-left: 0.25rem;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background: white;
            color: var(--text);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(26, 86, 168, 0.08);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .radio-option,
        .checkbox-option {
            position: relative;
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option label,
        .checkbox-option label {
            display: inline-block;
            padding: 0.7rem 1.4rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .radio-option input[type="radio"]:checked + label,
        .checkbox-option input[type="checkbox"]:checked + label {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(26, 86, 168, 0.25);
        }

        .radio-option label:hover,
        .checkbox-option label:hover {
            border-color: var(--primary-light);
            background: rgba(26, 86, 168, 0.04);
        }

        .device-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            transition: all 0.25s ease;
        }

        .device-card:hover {
            box-shadow: 0 2px 12px var(--shadow);
            border-color: var(--border);
        }

        .device-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .device-number {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .btn {
            padding: 0.8rem 1.6rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 2px 8px rgba(26, 86, 168, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 14px rgba(26, 86, 168, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: #C0392B;
            color: white;
            font-size: 0.85rem;
            padding: 0.6rem 1.2rem;
        }

        .btn-danger:hover {
            background: #A93226;
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-size: 1.05rem;
            padding: 1.1rem 2.2rem;
            box-shadow: 0 4px 16px rgba(26, 86, 168, 0.25);
            letter-spacing: 0.2px;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 22px rgba(26, 86, 168, 0.35);
        }

        .add-device-btn {
            width: 100%;
            border: 1.5px dashed var(--primary-light);
            background: rgba(26, 86, 168, 0.03);
            color: var(--primary);
            margin-top: 1rem;
        }

        .add-device-btn:hover {
            background: rgba(26, 86, 168, 0.07);
            border-color: var(--primary);
            border-style: solid;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                background: var(--surface);
            }

            .container {
                border-radius: 0;
                box-shadow: none;
                border: none;
            }

            .header {
                padding: 1.8rem 1.2rem;
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.5rem;
                letter-spacing: -0.3px;
            }

            .header p {
                font-size: 0.9rem;
            }

            .main-content {
                padding: 1rem 0.8rem;
            }

            .section {
                padding: 1.1rem;
                margin-bottom: 1rem;
                border-radius: 10px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.6rem;
                margin-bottom: 1rem;
                padding-bottom: 0.75rem;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            label {
                font-size: 0.88rem;
                margin-bottom: 0.35rem;
            }

            input[type="text"],
            input[type="email"],
            input[type="number"],
            select,
            textarea {
                padding: 0.75rem 0.85rem;
                font-size: 16px; /* prevents iOS zoom */
                border-radius: 8px;
            }

            textarea {
                min-height: 80px;
            }

            .radio-group,
            .checkbox-group {
                gap: 0.5rem;
            }

            .radio-option label,
            .checkbox-option label {
                padding: 0.6rem 1rem;
                font-size: 0.88rem;
            }

            .device-card {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 8px;
            }

            .device-card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                margin-bottom: 1rem;
                padding-bottom: 0.75rem;
            }

            .device-number {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
                padding: 0.85rem 1.2rem;
                font-size: 0.92rem;
            }

            .btn-danger {
                width: auto;
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }

            .btn-success {
                font-size: 1rem;
                padding: 1rem 1.5rem;
            }

            .add-device-btn {
                padding: 0.85rem 1rem;
            }

            .actions {
                flex-direction: column;
                margin-top: 1.5rem;
                padding-top: 1.2rem;
                gap: 0.6rem;
            }

            .toast {
                bottom: 1rem;
                right: 1rem;
                left: 1rem;
                text-align: center;
                font-size: 0.9rem;
                padding: 0.85rem 1rem;
            }
        }

        /* Small phones */
        @media (max-width: 380px) {
            .header h1 {
                font-size: 1.3rem;
            }

            .header p {
                font-size: 0.82rem;
            }

            .section {
                padding: 0.9rem;
            }

            .section-title {
                font-size: 1rem;
            }

            .radio-option label,
            .checkbox-option label {
                padding: 0.5rem 0.8rem;
                font-size: 0.82rem;
            }

            .checkbox-group {
                gap: 0.4rem;
            }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(26, 86, 168, 0.3);
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .conditional-section {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Pre-Sales Engineering</h1>
            <p>Modulo di raccolta informazioni per preventivi tecnici</p>
        </div>

        <div class="main-content">
            <!-- Dati Cliente -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìã Informazioni Cliente</h2>
                </div>
                <div class="grid">
                    <div class="form-group">
                        <label>Cliente <span class="required">*</span></label>
                        <input type="text" id="cliente" required>
                    </div>
                    <div class="form-group">
                        <label>A chi mandare l'offerta <span class="required">*</span></label>
                        <input type="text" id="destinatario" placeholder="Nome o Email" required>
                    </div>
                </div>
            </div>

            <!-- Selezione Tipo Dispositivo -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üíª Tipologia Dispositivi</h2>
                </div>
                <div class="checkbox-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-server" value="server">
                        <label for="type-server">üñ•Ô∏è Server</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-workstation" value="workstation">
                        <label for="type-workstation">üíº Workstation</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-pc" value="pc">
                        <label for="type-pc">üñ•Ô∏è PC</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-notebook" value="notebook">
                        <label for="type-notebook">üíª Notebook</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-aio" value="aio">
                        <label for="type-aio">üñ•Ô∏è All-in-One</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="type-copia" value="copia">
                        <label for="type-copia">üñ®Ô∏è Copiatrice/Stampante</label>
                    </div>
                </div>
            </div>

            <!-- Containers per dispositivi dinamici -->
            <div id="server-container" class="hidden"></div>
            <div id="workstation-container" class="hidden"></div>
            <div id="pc-container" class="hidden"></div>
            <div id="notebook-container" class="hidden"></div>
            <div id="aio-container" class="hidden"></div>
            <div id="copia-container" class="hidden"></div>

            <!-- Azioni -->
            <div class="actions">
                <button class="btn btn-success" onclick="generatePDF()">
                    üìÑ Genera PDF Report
                </button>
            </div>
        </div>
    </div>

    <script>
        // Contatori per dispositivi
        const deviceCounters = {
            server: 0,
            workstation: 0,
            pc: 0,
            notebook: 0,
            aio: 0,
            copia: 0
        };

        // Event listeners per checkboxes
        document.querySelectorAll('input[type="checkbox"][id^="type-"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const deviceType = this.value;
                const container = document.getElementById(`${deviceType}-container`);
                
                if (this.checked) {
                    container.classList.remove('hidden');
                    if (deviceCounters[deviceType] === 0) {
                        addDevice(deviceType);
                    }
                } else {
                    container.classList.add('hidden');
                }
            });
        });

        function addDevice(type) {
            deviceCounters[type]++;
            const container = document.getElementById(`${type}-container`);
            const deviceNumber = deviceCounters[type];
            
            let html = `
                <div class="section conditional-section" id="${type}-${deviceNumber}">
                    <div class="section-header">
                        <h2 class="section-title">${getDeviceIcon(type)} ${getDeviceName(type)} #${deviceNumber}</h2>
                        ${deviceNumber > 1 ? `<button class="btn btn-danger" onclick="removeDevice('${type}', ${deviceNumber})">üóëÔ∏è Rimuovi</button>` : ''}
                    </div>
                    <div class="device-card">
                        ${getDeviceForm(type, deviceNumber)}
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', html);

            if (type === 'server') {
                initServerTypeToggle(type, deviceNumber);
            }
            
            // Aggiungi pulsante per aggiungere altro dispositivo dello stesso tipo
            updateAddButton(type);
        }

        function initServerTypeToggle(type, number) {
            const deviceId = `${type}-${number}`;
            const radios = document.querySelectorAll(`input[name="${deviceId}-tipologia"]`);
            const virtualeSection = document.getElementById(`${deviceId}-virtuale-section`);

            if (!radios.length || !virtualeSection) return;

            const updateVisibility = (value) => {
                if (value === 'Virtuale') {
                    virtualeSection.classList.remove('hidden');
                } else {
                    virtualeSection.classList.add('hidden');
                }
            };

            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateVisibility(this.value);
                });

                if (radio.checked) {
                    updateVisibility(radio.value);
                }
            });
        }

        function removeDevice(type, number) {
            const element = document.getElementById(`${type}-${number}`);
            element.remove();
            updateAddButton(type);
        }

        function updateAddButton(type) {
            const container = document.getElementById(`${type}-container`);
            const existingBtn = container.querySelector('.add-device-section');
            if (existingBtn) existingBtn.remove();
            
            const addButtonHtml = `
                <div class="section add-device-section">
                    <button class="btn add-device-btn" onclick="addDevice('${type}')">
                        ‚ûï Aggiungi altro ${getDeviceName(type)}
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', addButtonHtml);
        }

        function getDeviceIcon(type) {
            const icons = {
                server: 'üñ•Ô∏è',
                workstation: 'üíº',
                pc: 'üñ•Ô∏è',
                notebook: 'üíª',
                aio: 'üñ•Ô∏è',
                copia: 'üñ®Ô∏è'
            };
            return icons[type] || 'üì¶';
        }

        function getDeviceName(type) {
            const names = {
                server: 'Server',
                workstation: 'Workstation',
                pc: 'PC',
                notebook: 'Notebook',
                aio: 'All-in-One',
                copia: 'Copiatrice/Stampante'
            };
            return names[type] || type;
        }

        function getDeviceForm(type, number) {
            const id = `${type}-${number}`;
            
            if (type === 'server') {
                return `
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Tipologia</h3>
                    <div class="radio-group" style="margin-bottom: 2rem;">
                        <div class="radio-option">
                            <input type="radio" id="${id}-fisico" name="${id}-tipologia" value="Fisico" checked>
                            <label for="${id}-fisico">Fisico</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="${id}-virtuale" name="${id}-tipologia" value="Virtuale">
                            <label for="${id}-virtuale">Virtuale</label>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Caratteristiche Hardware</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Spazio occupato (GB/TB)</label>
                            <input type="text" id="${id}-spazio">
                        </div>
                        <div class="form-group">
                            <label>RAM in uso (GB)</label>
                            <input type="number" id="${id}-ram">
                        </div>
                        <div class="form-group">
                            <label>Numero di core</label>
                            <input type="number" id="${id}-core">
                        </div>
                    </div>
                    
                    <div id="${id}-virtuale-section" class="hidden" style="margin-top: 1.5rem;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Virtualizzazione</h3>
                        <div class="grid">
                            <div class="form-group">
                                <label>Numero di VM</label>
                                <input type="number" id="${id}-vm">
                            </div>
                            <div class="form-group">
                                <label>Virtualizzatore desiderato</label>
                                <input type="text" id="${id}-virtualizzatore" placeholder="es. VMware, Hyper-V, Proxmox">
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1.5rem; color: var(--primary);">Software</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Software di backup</label>
                            <select id="${id}-backup">
                                <option value="">Seleziona...</option>
                                <option value="Veeam a pagamento">Veeam a pagamento</option>
                                <option value="Veeam EC">Veeam EC</option>
                                <option value="Acronis">Acronis</option>
                                <option value="Altro">Altro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Antivirus</label>
                            <select id="${id}-antivirus">
                                <option value="">Seleziona...</option>
                                <option value="Withsecure EPP">Withsecure EPP</option>
                                <option value="Withsecure EPP + EDR">Withsecure EPP + EDR</option>
                                <option value="Altro">Altro</option>
                            </select>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1.5rem; color: var(--primary);">Dispositivi di Rete</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Switch</label>
                            <select id="${id}-switch">
                                <option value="">Seleziona...</option>
                                <option value="Zyxel recente">Zyxel recente</option>
                                <option value="Terze parti recente">Terze parti recente</option>
                                <option value="Scrauso">Scrauso</option>
                                <option value="Altro">Altro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>NAS di Backup</label>
                            <select id="${id}-nas">
                                <option value="">Seleziona...</option>
                                <option value="NAS recente">NAS recente</option>
                                <option value="NAS scrauso">NAS scrauso</option>
                                <option value="Altro">Altro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Spazio NAS</label>
                            <select id="${id}-spazio-nas">
                                <option value="">Seleziona...</option>
                                <option value="Sufficiente">Sufficiente per le esigenze</option>
                                <option value="Sottodimensionato">Sottodimensionato</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Firewall</label>
                            <select id="${id}-firewall">
                                <option value="">Seleziona...</option>
                                <option value="Watchguard recente">Watchguard recente</option>
                                <option value="Watchguard da cambiare">Watchguard da cambiare</option>
                                <option value="Altra marca da cambiare">Altra marca da cambiare</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>UPS</label>
                            <select id="${id}-ups">
                                <option value="">Seleziona...</option>
                                <option value="Recente">Recente</option>
                                <option value="Da cambiare o sottodimensionato">Da cambiare o sottodimensionato</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label>Note aggiuntive</label>
                        <textarea id="${id}-note"></textarea>
                    </div>
                    
                `;
            } else if (type === 'copia') {
                return `
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Caratteristiche</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Numero pagine/mese</label>
                            <select id="${id}-pagine">
                                <option value="">Seleziona...</option>
                                <option value="<1000">&lt; 1000</option>
                                <option value="1000-10000">1000-10000</option>
                                <option value=">10000">&gt; 10000</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo dispositivo</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-mfp" name="${id}-tipodispositivo" value="MFP">
                                    <label for="${id}-mfp">MFP</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-soloprint" name="${id}-tipodispositivo" value="Solo stampa">
                                    <label for="${id}-soloprint">Solo stampa</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Contratto</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-noleggio" name="${id}-contratto" value="Noleggio">
                                    <label for="${id}-noleggio">Noleggio</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-proprieta" name="${id}-contratto" value="Di propriet√†">
                                    <label for="${id}-proprieta">Di propriet√†</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Formato</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-a3" name="${id}-formato" value="A3">
                                    <label for="${id}-a3">A3</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-a4" name="${id}-formato" value="A4">
                                    <label for="${id}-a4">A4</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Colore</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-colori" name="${id}-colore" value="Colori">
                                    <label for="${id}-colori">Colori</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-bn" name="${id}-colore" value="B/N">
                                    <label for="${id}-bn">B/N</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1.5rem; color: var(--primary);">Funzionalit√†</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Volume scansioni</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-scan-base" name="${id}-scan" value="Base">
                                    <label for="${id}-scan-base">Base</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-scan-intensivo" name="${id}-scan" value="Intensivo">
                                    <label for="${id}-scan-intensivo">Intensivo</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Stampa da dispositivi Apple</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-apple-si" name="${id}-apple" value="S√¨">
                                    <label for="${id}-apple-si">S√¨</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-apple-no" name="${id}-apple" value="No">
                                    <label for="${id}-apple-no">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>WiFi</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-wifi-si" name="${id}-wifi" value="S√¨">
                                    <label for="${id}-wifi-si">S√¨</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-wifi-no" name="${id}-wifi" value="No">
                                    <label for="${id}-wifi-no">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Cassetti aggiuntivi</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-cassetti-si" name="${id}-cassetti" value="S√¨">
                                    <label for="${id}-cassetti-si">S√¨</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-cassetti-no" name="${id}-cassetti" value="No">
                                    <label for="${id}-cassetti-no">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Finitura</label>
                            <select id="${id}-finitura">
                                <option value="">Seleziona...</option>
                                <option value="Non necessaria">Non necessaria</option>
                                <option value="Pinzatura">Pinzatura</option>
                                <option value="Bucatura">Bucatura</option>
                                <option value="Fascicolazione">Fascicolazione</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label>Periodi di picco stampa</label>
                        <input type="text" id="${id}-picchi" placeholder="es. fine mese, periodo fiscale">
                    </div>
                    
                    <div class="form-group">
                        <label>Note aggiuntive</label>
                        <textarea id="${id}-note"></textarea>
                    </div>
                `;
            } else {
                // PC, Workstation, Notebook, AIO
                return `
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Specifiche Hardware</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>CPU</label>
                            <select id="${id}-cpu">
                                <option value="">Seleziona...</option>
                                <option value="i3">i3</option>
                                <option value="i5 / Ultra 5">i5 / Ultra 5</option>
                                <option value="i7 / Ultra 7">i7 / Ultra 7</option>
                                <option value="i9 / Ultra 9">i9 / Ultra 9</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>RAM</label>
                            <select id="${id}-ram">
                                <option value="">Seleziona...</option>
                                <option value="16GB">16GB</option>
                                <option value="32GB">32GB</option>
                                <option value="64GB">64GB</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Disco</label>
                            <select id="${id}-disco">
                                <option value="">Seleziona...</option>
                                <option value="500GB">500GB</option>
                                <option value="1TB">1TB</option>
                                <option value="2TB">2TB</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>GPU Necessaria</label>
                            <select id="${id}-gpu">
                                <option value="">Seleziona...</option>
                                <option value="No">No</option>
                                <option value="Entry Level">Entry Level</option>
                                <option value="Fascia Media">Fascia Media</option>
                                <option value="Fascia Alta">Fascia Alta</option>
                            </select>
                        </div>
                    </div>
                    
                    ${type === 'notebook' ? `
                    <div class="form-group">
                        <label>Dimensione Display</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="${id}-13" name="${id}-display" value="13">
                                <label for="${id}-13">13"</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="${id}-15" name="${id}-display" value="15">
                                <label for="${id}-15">15"</label>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${type === 'aio' ? `
                    <div class="grid">
                        <div class="form-group">
                            <label>Colore</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-bianco" name="${id}-colore" value="Bianco">
                                    <label for="${id}-bianco">Bianco</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-nero" name="${id}-colore" value="Nero">
                                    <label for="${id}-nero">Nero</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Dimensione Display</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-24" name="${id}-display" value="24">
                                    <label for="${id}-24">24"</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-27" name="${id}-display" value="27">
                                    <label for="${id}-27">27"</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Secondo monitor con HDMI</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="${id}-monitor-si" name="${id}-monitor" value="S√¨">
                                    <label for="${id}-monitor-si">S√¨</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="${id}-monitor-no" name="${id}-monitor" value="No">
                                    <label for="${id}-monitor-no">No</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <h3 style="margin-top: 2rem; margin-bottom: 1.5rem; color: var(--primary);">Software</h3>
                    <div class="grid">
                        <div class="form-group">
                            <label>Office 365 o Office >2021 gi√† presente</label>
                            <select id="${id}-office">
                                <option value="">Seleziona...</option>
                                <option value="S√¨ 365">S√¨ 365</option>
                                <option value="S√¨ >2021">S√¨ >2021</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Antivirus</label>
                            <select id="${id}-antivirus">
                                <option value="">Seleziona...</option>
                                <option value="S√¨ Withsecure">S√¨ Withsecure</option>
                                <option value="S√¨ F-Secure">S√¨ F-Secure</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label>Note aggiuntive</label>
                        <textarea id="${id}-note"></textarea>
                    </div>
                `;
            }
        }

        function getFormValue(id) {
            const element = document.getElementById(id);
            if (!element) return '';
            
            if (element.type === 'radio') {
                const checked = document.querySelector(`input[name="${element.name}"]:checked`);
                return checked ? checked.value : '';
            }
            
            return element.value || '';
        }

        function collectData() {
            const data = {
                cliente: document.getElementById('cliente').value,
                destinatario: document.getElementById('destinatario').value,
                dispositivi: []
            };

            // Raccogli dati solo per i tipi di dispositivo selezionati
            ['server', 'workstation', 'pc', 'notebook', 'aio', 'copia'].forEach(type => {
                const checkbox = document.getElementById(`type-${type}`);
                if (!checkbox || !checkbox.checked) return;

                for (let i = 1; i <= deviceCounters[type]; i++) {
                    const deviceId = `${type}-${i}`;
                    const deviceSection = document.getElementById(deviceId);
                    
                    if (deviceSection) {
                        const deviceData = {
                            tipo: getDeviceName(type),
                            numero: i
                        };

                        // Raccogli tutti i campi del dispositivo
                        const inputs = deviceSection.querySelectorAll('input, select, textarea');
                        inputs.forEach(input => {
                            if (input.type === 'radio') {
                                // Per i radio, usa il name per ottenere il nome del campo (es. "tipo", "contratto")
                                if (input.name && input.name.startsWith(deviceId)) {
                                    const radioFieldName = input.name.replace(`${deviceId}-`, '');
                                    if (!deviceData[radioFieldName]) {
                                        const checked = deviceSection.querySelector(`input[name="${input.name}"]:checked`);
                                        if (checked) {
                                            deviceData[radioFieldName] = checked.value;
                                        }
                                    }
                                }
                            } else if (input.id && input.id.startsWith(deviceId)) {
                                const fieldName = input.id.replace(`${deviceId}-`, '');
                                if (input.value) {
                                    deviceData[fieldName] = input.value;
                                }
                            }
                        });

                        data.dispositivi.push(deviceData);
                    }
                }
            });

            return data;
        }

        function generatePDF() {
            const data = collectData();
            
            if (!data.cliente || !data.destinatario) {
                alert('Per favore compila i campi obbligatori: Cliente e Destinatario');
                return;
            }

            if (data.dispositivi.length === 0) {
                alert('Per favore aggiungi almeno un dispositivo');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let y = 20;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            const lineHeight = 7;

            // Helper per gestire nuove pagine
            function checkPageBreak(additionalHeight = 10) {
                if (y + additionalHeight > pageHeight - margin) {
                    doc.addPage();
                    y = 20;
                }
            }

            // Intestazione
            doc.setFillColor(0, 102, 255);
            doc.rect(0, 0, 210, 35, 'F');
            doc.setTextColor(255, 255, 255);
            
            // Titolo e sottotitolo (sinistra)
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('Pre-Sales Engineering', margin, 14);
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Report Raccolta Informazioni Cliente', margin, 21);
            
            // Info cliente (destra)
            const rightX = 190;
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text(data.cliente, rightX, 12, { align: 'right' });
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            doc.text(`Offerta per: ${data.destinatario}`, rightX, 18, { align: 'right' });
            
            // Data generazione
            const now = new Date();
            doc.setFontSize(7);
            doc.setTextColor(200, 220, 255);
            doc.text(`${now.toLocaleDateString('it-IT')} - ${now.toLocaleTimeString('it-IT')}`, rightX, 24, { align: 'right' });
            
            y = 42;
            doc.setTextColor(0, 0, 0);

            // Dispositivi
            data.dispositivi.forEach((device, index) => {
                checkPageBreak(30);
                
                // Separatore
                if (index > 0) {
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, y - 5, 190, y - 5);
                    y += 5;
                }

                // Titolo dispositivo
                doc.setFillColor(240, 242, 245);
                doc.roundedRect(margin, y - 5, 170, 10, 2, 2, 'F');
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 102, 255);
                doc.text(`${device.tipo} #${device.numero}`, margin + 3, y + 2);
                y += 12;

                // Campi del dispositivo
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(0, 0, 0);
                
                // Mappa etichette per i campi nel PDF
                const fieldLabels = {
                    'tipologia': 'Tipologia',
                    'spazio': 'Spazio occupato',
                    'ram': 'RAM',
                    'core': 'Numero di core',
                    'vm': 'Numero di VM',
                    'virtualizzatore': 'Virtualizzatore',
                    'backup': 'Software di backup',
                    'antivirus': 'Antivirus',
                    'switch': 'Switch',
                    'nas': 'NAS di Backup',
                    'spazio-nas': 'Spazio NAS',
                    'firewall': 'Firewall',
                    'ups': 'UPS',
                    'cpu': 'CPU',
                    'disco': 'Disco',
                    'gpu': 'GPU',
                    'display': 'Dimensione Display',
                    'colore': 'Colore',
                    'monitor': 'Secondo monitor HDMI',
                    'office': 'Office',
                    'pagine': 'Pagine/mese',
                    'tipodispositivo': 'Tipo dispositivo',
                    'contratto': 'Contratto',
                    'formato': 'Formato',
                    'scan': 'Volume scansioni',
                    'apple': 'Stampa Apple',
                    'wifi': 'WiFi',
                    'cassetti': 'Cassetti aggiuntivi',
                    'finitura': 'Finitura',
                    'picchi': 'Periodi di picco',
                    'note': 'Note aggiuntive'
                };

                Object.entries(device).forEach(([key, value]) => {
                    if (key !== 'tipo' && key !== 'numero' && value) {
                        checkPageBreak();
                        
                        // Formatta il nome del campo
                        const fieldName = fieldLabels[key] || key.charAt(0).toUpperCase() + key.slice(1).replace(/-/g, ' ');
                        
                        doc.setFont(undefined, 'bold');
                        doc.text(`${fieldName}:`, margin + 5, y);
                        doc.setFont(undefined, 'normal');
                        
                        // Gestisci testo lungo
                        const textWidth = 130;
                        const lines = doc.splitTextToSize(value, textWidth);
                        doc.text(lines, margin + 55, y);
                        y += lineHeight * lines.length;
                    }
                });
                
                y += 5;
            });

            // Footer
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(9);
                doc.setTextColor(150, 150, 150);
                doc.text(
                    `Pagina ${i} di ${totalPages}`,
                    doc.internal.pageSize.width / 2,
                    doc.internal.pageSize.height - 10,
                    { align: 'center' }
                );
            }

            // Salva PDF
            const filename = `PreSales_${data.cliente.replace(/\s+/g, '_')}_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}.pdf`;
            doc.save(filename);

            // Toast di conferma
            showToast('‚úÖ PDF generato con successo!');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
